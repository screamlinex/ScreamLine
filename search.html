<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Search | ScreamLine</title>
  <link rel="stylesheet" href="/ScreamLine/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="/ScreamLine/img/favicon.png" rel="icon">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    body { background: #dbd9d9; font-family: Arial, sans-serif; }
    .search-results { max-width: 1000px; margin: 40px auto; padding: 0 15px; }
    .result-item { display: flex; background: #fff; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); overflow: hidden; }
    .result-item img { width: 160px; height: 120px; object-fit: cover; }
    .result-content { padding: 15px; flex: 1; }
    .result-content h3 { font-size: 20px; margin: 0 0 10px; color: #222; }
    .result-content p { font-size: 14px; color: #555; }
    .result-content .meta { font-size: 13px; color: #999; margin-bottom: 8px; }
    #loading { text-align: center; padding: 40px; font-size: 18px; color: #666; }
  </style>
</head>

<body>

  <!-- Dynamic Header -->
  <div id="header"></div>

  <div class="search-results">
    <h2 id="search-title">Search Results</h2>
    <div id="results"></div>
    <div id="loading">Loading results...</div>
  </div>

  <!-- Dynamic Footer -->
  <div id="footer"></div>

  <script>
    // Load header & footer
    $("#header").load("/ScreamLine/templates/header.html");
    $("#footer").load("/ScreamLine/templates/footer.html");

    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get("q")?.trim().toLowerCase() || "";
    document.getElementById("search-title").innerText = query
      ? `Search results for: "${query}"`
      : "Enter a search term above.";

    const resultsContainer = document.getElementById("results");
    const loading = document.getElementById("loading");

    // âœ… Fetch stored index from localStorage
    const allNews = JSON.parse(localStorage.getItem("screamline_news_index") || "[]");

    function displayResults(results) {
      loading.style.display = "none";
      if (!results.length) {
        resultsContainer.innerHTML = `<p>No results found for "<b>${query}</b>".</p>`;
        return;
      }

      resultsContainer.innerHTML = results.map(r => `
        <div class="result-item">
          <img src="${r.img}" alt="${r.title}">
          <div class="result-content">
            <div class="meta">${r.date || ""}</div>
            <h3><a href="${r.link}">${r.title}</a></h3>
            <p>${r.desc}</p>
          </div>
        </div>
      `).join("");
    }

    function performSearch() {
      if (!query) {
        loading.innerText = "Please enter a search term above.";
        return;
      }

      if (!allNews.length) {
        loading.innerText = "Index not ready. Please refresh the page in a few seconds.";
        return;
      }

      const filtered = allNews.filter(r =>
        r.title.toLowerCase().includes(query) ||
        r.desc.toLowerCase().includes(query)
      );

      displayResults(filtered);
    }

    performSearch();
  </script>

  <script src="/ScreamLine/js/load-templates.js"></script>
</body>
</html>
