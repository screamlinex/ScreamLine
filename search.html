<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Search | ScreamLine</title>
  <link rel="stylesheet" href="/ScreamLine/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="/ScreamLine/img/favicon.png" rel="icon">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    body { background: #dbd9d9; font-family: Arial, sans-serif; }
    .search-results { max-width: 1000px; margin: 40px auto; padding: 0 15px; }
    .result-item { display: flex; background: #fff; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); overflow: hidden; }
    .result-item img { width: 160px; height: 120px; object-fit: cover; }
    .result-content { padding: 15px; flex: 1; }
    .result-content h3 { font-size: 20px; margin: 0 0 10px; color: #222; }
    .result-content p { font-size: 14px; color: #555; }
    .result-content .meta { font-size: 13px; color: #999; margin-bottom: 8px; }
    #loading { text-align: center; padding: 40px; font-size: 18px; color: #666; }
  </style>
</head>

<body>
  <!-- Dynamic Header -->
  <div id="header"></div>

  <div class="search-results">
    <h2 id="search-title">Search Results</h2>
    <div id="results"></div>
    <div id="loading">Loading results...</div>
  </div>

  <!-- Dynamic Footer -->
  <div id="footer"></div>

 <script>
  // Load header & footer dynamically
  $("#header").load("/ScreamLine/templates/header.html");
  $("#footer").load("/ScreamLine/templates/footer.html");

  const resultsContainer = document.getElementById("results");
  const loading = document.getElementById("loading");

  // Get search query
  const urlParams = new URLSearchParams(window.location.search);
  const query = urlParams.get("q")?.trim().toLowerCase() || "";
  document.getElementById("search-title").innerText = `Search results for: "${query}"`;

  // Normalize image/link paths
  function normalizePath(path, defaultImg="/ScreamLine/img/default.jpg") {
    return path ? path : defaultImg;
  }

  // Fetch the JSON file
  fetch("/ScreamLine/filelist.json")
    .then(res => res.json())
    .then(allNews => {
      loading.style.display = "none";

      // Filter by query
      const filtered = query
        ? allNews.filter(item =>
            item.title.toLowerCase().includes(query) ||
            item.desc.toLowerCase().includes(query)
          )
        : allNews; // show all if no query

      if (filtered.length === 0) {
        resultsContainer.innerHTML = `<p>No results found for "<b>${query}</b>".</p>`;
        return;
      }

      // Display results
      resultsContainer.innerHTML = filtered.map(item => `
        <div class="result-item">
          <img src="${normalizePath(item.img)}" alt="${item.title}">
          <div class="result-content">
            <div class="meta">${item.date}</div>
            <h3><a href="${item.link}">${item.title}</a></h3>
            <p>${item.desc}</p>
          </div>
        </div>
      `).join("");
    })
    .catch(err => {
      console.error("Error loading filelist.json:", err);
      loading.innerText = "Failed to load news. Please try again later.";
    });
</script>


  <script src="/ScreamLine/js/load-templates.js"></script>
</body>
</html>
